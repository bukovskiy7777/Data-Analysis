# Payment Analyst Test Task

В цьому тестовому завданні ти попрацюєш із таблицею `subscription_transactions` (посилання на [csv-файл](https://drive.google.com/file/d/1eMmYxdNd-livW8Lx5C-1e3yQCHRX2_iy/view?usp=sharing)), яка містить інформацію про різні типи транзакцій користувача. Модель монетизації наших продуктів **підписка**, платформа продуктів - **WEB**, відповідно, використовуємо **web-платежі**.

**Структура датасету**

- `user_id` —  ідентифікатор користувача
- `transaction_id` — ідентифікатор транзакції
- `reference_transaction_id` — ідентифікатор батьківської транзакції, вказує на транзакцію по якій відбулось повернення (рефанд, чарджбек, тощо) або операція захоплення коштів (capture).
- `project` — проєкт
- `plan_id` — тип підписки, яку купує користувач
- `transaction_type` — тип транзакції
    - SALE - транзакція оплати по підписці
    - CAPTURE - транзакція захоплення коштів (лише для транзакцій із [двостадійним флоу](https://docs.stripe.com/payments/place-a-hold-on-a-payment-method)).
    - REFUND, VOID, CHARGEBACK, ALERT, DISPUTE - транзакції повернення коштів по підписці (кожен тип транзакції відповідає конкретному типу повернення коштів).
- `status` — статус транзакції
- `transaction_time` — дата та час транзакції
- `country` — країна користувача
- `psp_name` — платіжний провайдер / назва акаунта процесінгу
- `payment_method_type` — тип платіжного методу
- `card_brand`, `card_type`, `card_level` — атрибути картки користувача
- `amount_usd` — сума транзакції в USD
- `fee_usd` — комісія (якщо додатня - ми сплачуємо її процесінгу, якщо відʼємна - процесінг повертає її нам)


## Завдання 1: SQL

### Платіжна воронка

Напиши SQL запит на основі описаної вище таблиці, що відтворює платіжну воронку наших користувачів у межах їх підписки. Воронка повинна включати лише транзакції типу `SALE`.

Окрім визначення порядку платежів, потрібно пронумерувати повторні спроби списання в межах одного поновлення. Наприклад, користувач оформив підписку (здійснив успішну оплату першого місяця), наступного місяця здійснюється повторне списання, але з першої спроби нам не вдається здійснити оплату і ми пробуємо повторно через кілька проміжків часу — це формує retry-стратегію. Таким чином будь якому успішному ребілу може передувати серія declined транзакцій які є його ретраями. Для того щоб якісно аналізувати перформанс retry-стратегію потрібно визначити порядок ретраїв.

Результат запиту має містити наступні колонки:

- `user_id` —  ідентифікатор користувача
- `transaction_id` — ідентифікатор транзакції
- `project` — проєкт
- `plan_id` — тип підписки, яку купує користувач
- `transaction_time` — дата та час транзакції
- `status` — статус транзакції
- `renewal_number` — номер поновлення підписки*, порядок ребілу.
- `retry_number` — в межах кожного поновлення підписки*, порядок ребілу.
- `net_revenue` — revenue з урахуванням повернення коштів по цій транзакції та усіх комісій

**Якщо користувач мав декілька підписок, кожна з них вважається окремим ланцюжком*

---

## Завдання 2: EDA + BI

В цьому завданні ми хочемо оцінити твої навички аналізу та візуалізації даних.

### 1. Дослідження даних

Спершу потрібно провести **дослідження датасету (EDA)**. Для дослідження даних бажано використовувати Python. Як результат можна надати сolab-ноутбук, який обовʼязково включатиме висновки EDA.


### 2. High-level payment dashboard

Побудуй high-level дашборд на основі наданого датасету, що включатиме критично важливі метриками веб-платежів для щоденного моніторингу перформансу і стабільності платіжної інфраструктури та продуктів, що нею користуються.

Ти можеш використовувати **будь-який BI-інструмент**, але окрім самого BI файлу потрібно надати **текстовий опис** до нього.

Опис має містити:

- логіку або формулу розрахунку метрик;
- пояснення, чому цю метрику важливо трекати;
- перелік фільтрів/параметрів;
- скріншоти візуалізацій.

**Додатково** можеш надати рекомендації:

- яких даних не вистачає для більш якісного аналізу;
- які ще метрики важливо моніторити (можливо вони не є критично важливими, але ти вважаєш що їх варто додати до моніторингу).


☺️

Ми цінуємо твій час і час команди, тому просимо сфокусуватися на ключових метриках та інсайтах. Надмірна деталізація не є необхідною — для нас важливі твій підхід і логіка прийняття рішень.

---

<img width="1399" height="681" alt="image" src="https://github.com/user-attachments/assets/d8854e9c-6183-4087-a9eb-7d95a0acd848" /> 
<br /> <br />
<img width="1390" height="760" alt="image" src="https://github.com/user-attachments/assets/68d236cb-d299-4403-a2ff-fd334c47f2cc" />

